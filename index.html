<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fian Health Staff Welfare</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --accent: #e74c3c;
      --success: #2ecc71;
      --warning: #f39c12;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --radius: 10px;
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--dark);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      width: 100%;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: flex;
      min-height: 90vh;
    }
    
    /* Login Section */
    .login-section {
      flex: 1;
      padding: 50px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
      color: white;
      position: relative;
      overflow: hidden;
    }
    
    .login-section::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
    }
    
    .login-content {
      position: relative;
      z-index: 2;
      max-width: 450px;
      margin: 0 auto;
      width: 100%;
    }
    
    .logo {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .logo i {
      font-size: 70px;
      color: white;
      margin-bottom: 20px;
      background: rgba(255, 255, 255, 0.1);
      width: 120px;
      height: 120px;
      line-height: 120px;
      border-radius: 50%;
    }
    
    .logo h1 {
      font-size: 2.5rem;
      font-weight: 700;
    }
    
    .login-info {
      background: rgba(255, 255, 255, 0.1);
      padding: 25px;
      border-radius: var(--radius);
      margin-top: 30px;
      backdrop-filter: blur(5px);
    }
    
    .login-info h3 {
      font-size: 1.4rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .login-info ul {
      padding-left: 25px;
    }
    
    .login-info li {
      margin-bottom: 10px;
    }
    
    /* App Section */
    .app-section {
      flex: 2;
      display: flex;
      flex-direction: column;
      min-height: 90vh;
    }
    
    /* Header */
    header {
      background: linear-gradient(120deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .header-content {
      flex: 1;
    }
    
    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .subtitle {
      font-weight: 300;
      opacity: 0.9;
      font-size: 1rem;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .user-info span {
      font-weight: 500;
    }
    
    .logout-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 30px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: var(--transition);
    }
    
    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* Navigation */
    nav {
      background: white;
      padding: 15px 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .nav-btn {
      padding: 12px 20px;
      background: linear-gradient(to right, var(--secondary), #2980b9);
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
    }
    
    .nav-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
    }
    
    .nav-btn i {
      font-size: 1.1rem;
    }
    
    /* Content */
    .content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }
    
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .action-btn {
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      font-size: 0.9rem;
    }
    
    .download-btn {
      background: var(--success);
      color: white;
    }
    
    .csv-btn {
      background: #9b59b6;
      color: white;
    }
    
    .download-btn:hover {
      background: #27ae60;
    }
    
    .csv-btn:hover {
      background: #8e44ad;
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 35px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      border-left: 5px solid var(--secondary);
      transition: var(--transition);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
    
    .stat-card h3 {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--secondary);
    }
    
    .stat-card p {
      color: #7f8c8d;
      font-size: 0.95rem;
      font-weight: 500;
    }
    
    .stat-card .stat-icon {
      width: 50px;
      height: 50px;
      background: rgba(52, 152, 219, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }
    
    .stat-card .stat-icon i {
      font-size: 1.5rem;
      color: var(--secondary);
    }
    
    /* Search and Filter */
    .search-filter-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .search-box {
      flex: 1;
      min-width: 250px;
      position: relative;
    }
    
    .search-box input {
      width: 100%;
      padding: 12px 15px 12px 40px;
      border: 1px solid #ddd;
      border-radius: 30px;
      font-size: 0.95rem;
      transition: var(--transition);
    }
    
    .search-box input:focus {
      border-color: var(--secondary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    
    .search-box i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #7f8c8d;
    }
    
    .filter-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .filter-btn {
      padding: 8px 15px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 30px;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: var(--transition);
    }
    
    .filter-btn.active {
      background: var(--secondary);
      color: white;
      border-color: var(--secondary);
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 25px;
    }
    
    thead {
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
    }
    
    th {
      padding: 14px 18px;
      text-align: left;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: var(--transition);
    }
    
    th:hover {
      background: rgba(0,0,0,0.1);
    }
    
    th:first-child {
      border-top-left-radius: var(--radius);
    }
    
    th:last-child {
      border-top-right-radius: var(--radius);
    }
    
    tbody tr {
      transition: var(--transition);
    }
    
    tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    
    tbody tr:hover {
      background-color: #e8f4fd;
    }
    
    td {
      padding: 12px 18px;
      border-bottom: 1px solid #e0e0e0;
      font-size: 0.95rem;
    }
    
    .paid-status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 30px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .paid {
      background-color: #e8f5e9;
      color: var(--success);
    }
    
    .unpaid {
      background-color: #ffebee;
      color: var(--accent);
    }
    
    .action-cell {
      display: flex;
      gap: 8px;
    }
    
    .action-icon {
      padding: 6px;
      border-radius: 50%;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .edit-icon {
      background: rgba(52, 152, 219, 0.1);
      color: var(--secondary);
    }
    
    .edit-icon:hover {
      background: rgba(52, 152, 219, 0.2);
    }
    
    .delete-icon {
      background: rgba(231, 76, 60, 0.1);
      color: var(--accent);
    }
    
    .delete-icon:hover {
      background: rgba(231, 76, 60, 0.2);
    }
    
    /* Login Form */
    .login-form {
      background: white;
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
      max-width: 450px;
      width: 100%;
      margin: 0 auto;
    }
    
    .login-form h2 {
      text-align: center;
      margin-bottom: 25px;
      color: var(--primary);
    }
    
    .form-group {
      margin-bottom: 20px;
      position: relative;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }
    
    input {
      width: 100%;
      padding: 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: var(--transition);
    }
    
    input:focus {
      border-color: var(--secondary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    
    .btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: var(--transition);
      margin-top: 10px;
      position: relative;
      overflow: hidden;
    }
    
    .btn-login {
      background: linear-gradient(to right, var(--success), #27ae60);
      color: white;
      box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
    }
    
    .btn-login:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(46, 204, 113, 0.4);
    }
    
    .forgot-password {
      text-align: center;
      margin-top: 15px;
      font-size: 0.9rem;
    }
    
    .forgot-password a {
      color: var(--secondary);
      text-decoration: none;
      transition: var(--transition);
    }
    
    .forgot-password a:hover {
      text-decoration: underline;
    }
    
    /* Password Visibility Toggle */
    .password-container {
      position: relative;
    }
    
    .toggle-password {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #7f8c8d;
    }
    
    /* Loading */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 300px;
      flex-direction: column;
      gap: 25px;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(52, 152, 219, 0.2);
      border-top-color: var(--secondary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      padding: 18px 28px;
      border-radius: var(--radius);
      color: white;
      font-weight: 500;
      box-shadow: var(--shadow);
      transform: translateX(100px);
      opacity: 0;
      transition: var(--transition);
      z-index: 2000;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }
    
    .toast.success {
      background: linear-gradient(to right, var(--success), #27ae60);
    }
    
    .toast.error {
      background: linear-gradient(to right, var(--accent), #c0392b);
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(3px);
    }
    
    .modal-content {
      background: white;
      border-radius: var(--radius);
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }
    
    .modal-header {
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h2 {
      font-weight: 600;
      font-size: 1.5rem;
    }
    
    .close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.8rem;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .close-btn:hover {
      transform: rotate(90deg);
    }
    
    .modal-body {
      padding: 25px;
    }
    
    .btn-group {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 20px;
    }
    
    .btn-cancel {
      background: #ecf0f1;
      color: #7f8c8d;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .btn-confirm {
      background: var(--accent);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    
    /* Responsive */
    @media (max-width: 900px) {
      .container {
        flex-direction: column;
        min-height: auto;
      }
      
      .login-section {
        padding: 30px;
      }
      
      .app-section {
        min-height: auto;
      }
    }
    
    @media (max-width: 600px) {
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .nav-btn {
        width: 100%;
        justify-content: center;
      }
      
      header {
        flex-direction: column;
        text-align: center;
      }
      
      .user-info {
        justify-content: center;
        width: 100%;
      }
      
      .action-buttons {
        width: 100%;
        justify-content: center;
        margin-top: 15px;
      }
      
      th, td {
        padding: 10px 12px;
        font-size: 0.85rem;
      }
      
      .action-cell {
        flex-direction: column;
        gap: 5px;
      }
    }
    
    /* Button loading state */
    .btn-loading {
      pointer-events: none;
      opacity: 0.7;
    }
    
    .btn-loading::after {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      margin: auto;
      border: 4px solid transparent;
      border-top-color: #ffffff;
      border-radius: 50%;
      animation: button-loading-spinner 1s ease infinite;
    }
    
    @keyframes button-loading-spinner {
      from {
        transform: rotate(0turn);
      }
      to {
        transform: rotate(1turn);
      }
    }
    
    /* Hosting Instructions */
    .instructions {
      background: #f8f9fa;
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 30px;
      box-shadow: var(--shadow);
    }
    
    .instructions h3 {
      color: var(--primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .instructions ol {
      padding-left: 25px;
    }
    
    .instructions li {
      margin-bottom: 12px;
      line-height: 1.6;
    }
    
    .instructions code {
      background: #e9ecef;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Login Section -->
    <div class="login-section">
      <div class="login-content">
        <div class="logo">
          <i class="fas fa-hand-holding-heart"></i>
          <h1>Fian Health Staff Welfare</h1>
        </div>
        
        <div class="login-form">
          <h2><i class="fas fa-lock"></i> Admin Login</h2>
          <div class="form-group">
            <label for="loginEmail">Email Address</label>
            <input type="email" id="loginEmail" placeholder="admin@fianhealth.com">
          </div>
          <div class="form-group">
            <label for="loginPassword">Password</label>
            <div class="password-container">
              <input type="password" id="loginPassword" placeholder="Enter your password">
              <i class="fas fa-eye toggle-password" id="togglePassword"></i>
            </div>
          </div>
          <button class="btn btn-login" id="loginBtn">Login to Dashboard</button>
          <div class="forgot-password">
            <a href="#" id="forgotPasswordLink">Forgot Password?</a>
          </div>
          <div class="form-group" style="text-align: center; margin-top: 20px;">
            <p style="font-size: 0.9rem;">Default credentials: admin@fianhealth.com / fianhealth123</p>
          </div>
        </div>
        
        <div class="login-info">
          <h3><i class="fas fa-info-circle"></i> About This System</h3>
          <ul>
            <li>Track staff welfare contributions</li>
            <li>Monitor payment status in real-time</li>
            <li>Generate PDF reports</li>
            <li>Manage staff records</li>
            <li>Search and filter functionality</li>
            <li>Export to CSV option</li>
          </ul>
          
          <div class="instructions">
            <h3><i class="fas fa-cloud-upload-alt"></i> Hosting on GitHub Pages</h3>
            <ol>
              <li>Create a new GitHub repository</li>
              <li>Name it <code>yourusername.github.io</code></li>
              <li>Save this file as <code>index.html</code></li>
              <li>Upload to your repository</li>
              <li>Go to Settings → Pages → Select main branch</li>
              <li>Your app will be live at: <code>https://yourusername.github.io</code></li>
            </ol>
          </div>
        </div>
      </div>
    </div>
    
    <!-- App Section (Initially hidden) -->
    <div class="app-section" id="appSection" style="display: none;">
      <header>
        <div class="header-content">
          <h1>Fian Health Staff Welfare</h1>
          <p class="subtitle">Contributions Management System • Started July 2024</p>
        </div>
        <div class="user-info">
          <span id="userEmail">admin@fianhealth.com</span>
          <button class="logout-btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </header>
      
      <nav>
        <button class="nav-btn" onclick="showDashboard()">
          <i class="fas fa-chart-bar"></i> Dashboard
        </button>
        <button class="nav-btn" onclick="openAddStaffModal()">
          <i class="fas fa-user-plus"></i> Add New Staff
        </button>
        <button class="nav-btn" onclick="showPaymentHistory()">
          <i class="fas fa-history"></i> Payment History
        </button>
      </nav>
      
      <div class="content" id="content">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading staff data from Firestore...</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Add Staff Modal -->
  <div id="addStaffModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add New Staff</h2>
        <button class="close-btn" onclick="closeAddStaffModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="staffName">Full Name:</label>
          <input type="text" id="staffName" placeholder="Enter staff full name">
          <div id="nameError" style="color: var(--accent); font-size: 0.85rem; margin-top: 5px; display: none;">Name must be at least 3 characters</div>
        </div>
        <div class="form-group">
          <label for="paidMonths">Months Paid:</label>
          <input type="number" id="paidMonths" placeholder="Enter number of months" value="0" min="0">
          <div id="monthsError" style="color: var(--accent); font-size: 0.85rem; margin-top: 5px; display: none;">Months must be a non-negative number</div>
        </div>
        <div class="btn-group">
          <button class="btn-cancel" onclick="closeAddStaffModal()">Cancel</button>
          <button class="btn-confirm" onclick="addNewStaff()">Add Staff</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Edit Staff Modal -->
  <div id="editStaffModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Staff Details</h2>
        <button class="close-btn" onclick="closeEditStaffModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="editStaffName">Name:</label>
          <input type="text" id="editStaffName" placeholder="Enter staff name">
          <div id="editNameError" style="color: var(--accent); font-size: 0.85rem; margin-top: 5px; display: none;">Name must be at least 3 characters</div>
        </div>
        <div class="form-group">
          <label for="editPaidMonths">Months Paid:</label>
          <input type="number" id="editPaidMonths" placeholder="Enter paid months" min="0">
          <div id="editMonthsError" style="color: var(--accent); font-size: 0.85rem; margin-top: 5px; display: none;">Months must be a non-negative number</div>
        </div>
        <div class="btn-group">
          <button class="btn-cancel" onclick="closeEditStaffModal()">Cancel</button>
          <button class="btn-confirm" onclick="updateStaffDetails()">Update Details</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Delete Confirmation Modal -->
  <div id="deleteStaffModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Confirm Deletion</h2>
        <button class="close-btn" onclick="closeDeleteStaffModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to permanently delete <strong id="deleteStaffName"></strong>?</p>
        <p>This action cannot be undone and will remove all payment records for this staff member.</p>
        <div class="btn-group">
          <button class="btn-cancel" onclick="closeDeleteStaffModal()">Cancel</button>
          <button class="btn-confirm" onclick="confirmDeleteStaff()">Delete Permanently</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Forgot Password Modal -->
  <div id="forgotPasswordModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Reset Password</h2>
        <button class="close-btn" onclick="closeForgotPasswordModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="resetEmail">Enter your email address:</label>
          <input type="email" id="resetEmail" placeholder="your@email.com">
        </div>
        <div class="btn-group">
          <button class="btn-cancel" onclick="closeForgotPasswordModal()">Cancel</button>
          <button class="btn-confirm" onclick="sendPasswordReset()">Send Reset Link</button>
        </div>
      </div>
    </div>
  </div>
  
  <div id="toast" class="toast">
    <i class="fas fa-check-circle"></i>
    <span>Operation completed successfully!</span>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA_f5Ar7pRasRIWET9PgggvfTgJQYORJjA",
      authDomain: "fian-staff-welfare-app.firebaseapp.com",
      databaseURL: "https://fian-staff-welfare-app-default-rtdb.firebaseio.com",
      projectId: "fian-staff-welfare-app",
      storageBucket: "fian-staff-welfare-app.firebasestorage.app",
      messagingSenderId: "424726826181",
      appId: "1:424726826181:web:497dd9fc1b6b44f4f034ac"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    // Initialize global variables
    let staffData = [];
    let currentStaffId = null;
    let currentSort = { column: null, direction: 'asc' };
    let currentFilter = 'all';
    let currentSearch = '';
    
    // DOM elements
    const appSection = document.getElementById('appSection');
    const contentDiv = document.getElementById('content');
    const userEmailSpan = document.getElementById('userEmail');
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const togglePassword = document.getElementById('togglePassword');
    const forgotPasswordLink = document.getElementById('forgotPasswordLink');
    
    // Set up auth state listener
    auth.onAuthStateChanged(user => {
      if (user) {
        // User is signed in
        userEmailSpan.textContent = user.email;
        appSection.style.display = 'flex';
        loadStaffData();
      } else {
        // User is signed out
        appSection.style.display = 'none';
      }
    });
    
    // Login function
    loginBtn.addEventListener('click', () => {
      const email = loginEmail.value;
      const password = loginPassword.value;
      
      if (!email || !password) {
        showToast("Please enter email and password", "error");
        return;
      }
      
      // Add loading state to button
      loginBtn.classList.add('btn-loading');
      loginBtn.innerHTML = 'Logging in...';
      
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          showToast("Login successful! Loading dashboard...", "success");
        })
        .catch((error) => {
          console.error("Login error:", error);
          showToast("Login failed: " + error.message, "error");
        })
        .finally(() => {
          // Remove loading state
          loginBtn.classList.remove('btn-loading');
          loginBtn.innerHTML = 'Login to Dashboard';
        });
    });
    
    // Logout function
    logoutBtn.addEventListener('click', () => {
      auth.signOut().then(() => {
        showToast("You have been logged out", "success");
      }).catch((error) => {
        console.error("Logout error:", error);
        showToast("Logout failed: " + error.message, "error");
      });
    });
    
    // Toggle password visibility
    togglePassword.addEventListener('click', () => {
      const type = loginPassword.getAttribute('type') === 'password' ? 'text' : 'password';
      loginPassword.setAttribute('type', type);
      togglePassword.classList.toggle('fa-eye');
      togglePassword.classList.toggle('fa-eye-slash');
    });
    
    // Forgot password functionality
    forgotPasswordLink.addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('forgotPasswordModal').style.display = 'flex';
    });
    
    function closeForgotPasswordModal() {
      document.getElementById('forgotPasswordModal').style.display = 'none';
    }
    
    function sendPasswordReset() {
      const email = document.getElementById('resetEmail').value;
      
      if (!email) {
        showToast("Please enter your email address", "error");
        return;
      }
      
      auth.sendPasswordResetEmail(email)
        .then(() => {
          showToast("Password reset email sent. Please check your inbox.", "success");
          closeForgotPasswordModal();
        })
        .catch((error) => {
          console.error("Password reset error:", error);
          showToast("Error sending reset email: " + error.message, "error");
        });
    }
    
    // Create admin account if not exists (for first-time setup)
    function createAdminAccount() {
      const email = "admin@fianhealth.com";
      const password = "fianhealth123";
      
      auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          console.log("Admin account created successfully");
          // Sign out after creating account
          auth.signOut();
        })
        .catch((error) => {
          if (error.code === 'auth/email-already-in-use') {
            console.log("Admin account already exists");
          } else {
            console.error("Error creating admin account:", error);
          }
        });
    }
    
    // Load staff data from Firestore
    function loadStaffData() {
      contentDiv.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading staff data from Firestore...</p>
        </div>
      `;
      
      db.collection("staff").orderBy("name")
        .onSnapshot((snapshot) => {
          staffData = [];
          snapshot.forEach(doc => {
            staffData.push({ id: doc.id, ...doc.data() });
          });
          
          if (staffData.length === 0) {
            // If no data, initialize with sample data
            initializeSampleData();
          } else {
            showDashboard();
          }
        }, (error) => {
          console.error("Error loading staff data:", error);
          showToast("Error loading staff data: " + error.message, "error");
          contentDiv.innerHTML = `
            <div style="text-align: center; padding: 50px;">
              <h3>Error Loading Data</h3>
              <p>${error.message}</p>
              <button class="btn-confirm" onclick="loadStaffData()">Retry</button>
            </div>
          `;
        });
    }
    
    // Initialize sample data if Firestore is empty
    function initializeSampleData() {
      const sampleStaff = [
        { name: "THOMAS BELENIBE", paidMonths: 5, totalAmount: 100, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "ADU DANIEL", paidMonths: 3, totalAmount: 60, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "KUUBURO REGINA", paidMonths: 3, totalAmount: 60, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "DEDUONG ERIC", paidMonths: 6, totalAmount: 120, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "SAYORE ALICE", paidMonths: 6, totalAmount: 120, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "ANGUM ANITA", paidMonths: 3, totalAmount: 60, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "OBENEY RACHEAL", paidMonths: 3, totalAmount: 60, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "SACKYIWAA ELIZABETH", paidMonths: 5, totalAmount: 100, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "KONDI JOSEPHINE", paidMonths: 7, totalAmount: 140, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "MATHEW DONGLEBO", paidMonths: 5, totalAmount: 100, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "NASARE SURAJ", paidMonths: 3, totalAmount: 60, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "MUHAMMED MUHASEIN", paidMonths: 5, totalAmount: 100, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "BADU LUCY", paidMonths: 5, totalAmount: 100, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "SUNDAARI CLETUS", paidMonths: 5, totalAmount: 100, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "ISSAH JOSEPH", paidMonths: 5, totalAmount: 100, lastUpdated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) },
        { name: "TIZIE RAYMOND", paidMonths: 0, totalAmount: 0, lastUpdated: "Not Paid" },
        { name: "SEI JACOB", paidMonths: 0, totalAmount: 0, lastUpdated: "Not Paid" },
        { name: "DERY LYDIA", paidMonths: 0, totalAmount: 0, lastUpdated: "Not Paid" },
        { name: "NIGREY NOREEN", paidMonths: 0, totalAmount: 0, lastUpdated: "Not Paid" }
      ];
      
      const batch = db.batch();
      const staffCollection = db.collection("staff");
      
      sampleStaff.forEach(staff => {
        const docRef = staffCollection.doc();
        batch.set(docRef, staff);
      });
      
      batch.commit()
        .then(() => {
          showToast("Sample data initialized successfully", "success");
        })
        .catch(error => {
          console.error("Error initializing sample data:", error);
          showToast("Error initializing sample data: " + error.message, "error");
        });
    }
    
    // Show dashboard
    function showDashboard() {
      // Filter and sort staff data
      let filteredData = [...staffData];
      
      // Apply search filter
      if (currentSearch) {
        const searchTerm = currentSearch.toLowerCase();
        filteredData = filteredData.filter(staff => 
          staff.name.toLowerCase().includes(searchTerm)
        );
      }
      
      // Apply status filter
      if (currentFilter === 'paid') {
        filteredData = filteredData.filter(staff => staff.paidMonths > 0);
      } else if (currentFilter === 'unpaid') {
        filteredData = filteredData.filter(staff => staff.paidMonths === 0);
      }
      
      // Apply sorting
      if (currentSort.column) {
        filteredData.sort((a, b) => {
          let valueA, valueB;
          
          if (currentSort.column === 'name') {
            valueA = a.name.toLowerCase();
            valueB = b.name.toLowerCase();
          } else if (currentSort.column === 'paidMonths') {
            valueA = a.paidMonths;
            valueB = b.paidMonths;
          } else if (currentSort.column === 'totalAmount') {
            valueA = a.totalAmount;
            valueB = b.totalAmount;
          } else {
            valueA = a.lastUpdated;
            valueB = b.lastUpdated;
          }
          
          if (valueA < valueB) return currentSort.direction === 'asc' ? -1 : 1;
          if (valueA > valueB) return currentSort.direction === 'asc' ? 1 : -1;
          return 0;
        });
      }
      
      // Calculate statistics
      const totalStaff = filteredData.length;
      const totalContributions = filteredData.reduce((sum, staff) => sum + staff.totalAmount, 0);
      const paidStaff = filteredData.filter(staff => staff.paidMonths > 0).length;
      const unpaidStaff = totalStaff - paidStaff;
      
      let content = `
        <div class="dashboard-header">
          <div>
            <h2>Staff Welfare Dashboard</h2>
            <div>
              <strong>Last Updated:</strong> ${new Date().toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              })}
            </div>
          </div>
          <div class="action-buttons">
            <button class="action-btn download-btn" onclick="generatePDF()">
              <i class="fas fa-file-pdf"></i> PDF Report
            </button>
            <button class="action-btn csv-btn" onclick="exportToCSV()">
              <i class="fas fa-file-csv"></i> CSV Export
            </button>
          </div>
        </div>
        
        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <h3>${totalStaff}</h3>
            <p>Total Staff</p>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <h3>GH₵ ${totalContributions}</h3>
            <p>Total Contributions</p>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3>${paidStaff}</h3>
            <p>Staff Paid</p>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-exclamation-circle"></i>
            </div>
            <h3>${unpaidStaff}</h3>
            <p>Staff Not Paid</p>
          </div>
        </div>
        
        <div class="search-filter-container">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search staff by name..." oninput="filterStaff()">
          </div>
          <div class="filter-buttons">
            <button class="filter-btn ${currentFilter === 'all' ? 'active' : ''}" onclick="setFilter('all')">
              <i class="fas fa-list"></i> All
            </button>
            <button class="filter-btn ${currentFilter === 'paid' ? 'active' : ''}" onclick="setFilter('paid')">
              <i class="fas fa-check-circle"></i> Paid
            </button>
            <button class="filter-btn ${currentFilter === 'unpaid' ? 'active' : ''}" onclick="setFilter('unpaid')">
              <i class="fas fa-times-circle"></i> Unpaid
            </button>
          </div>
        </div>
        
        <div style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th onclick="sortTable('name')">Staff Name <i class="fas fa-sort"></i></th>
                <th onclick="sortTable('paidMonths')">Paid Months <i class="fas fa-sort"></i></th>
                <th onclick="sortTable('totalAmount')">Total Amount (GH₵) <i class="fas fa-sort"></i></th>
                <th onclick="sortTable('lastUpdated')">Last Updated <i class="fas fa-sort"></i></th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      if (filteredData.length === 0) {
        content += `
          <tr>
            <td colspan="6" style="text-align: center; padding: 30px;">
              <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 15px; color: #7f8c8d;"></i>
              <h3>No matching staff found</h3>
              <p>Try adjusting your search or filter criteria</p>
            </td>
          </tr>
        `;
      } else {
        filteredData.forEach(staff => {
          const status = staff.paidMonths > 0 ? 
            `<span class="paid-status paid">Paid</span>` : 
            `<span class="paid-status unpaid">Not Paid</span>`;
          
          content += `
            <tr>
              <td>${staff.name}</td>
              <td>${staff.paidMonths}</td>
              <td>${staff.totalAmount}</td>
              <td>${staff.lastUpdated}</td>
              <td>${status}</td>
              <td class="action-cell">
                <div class="action-icon edit-icon" onclick="openEditStaffModal('${staff.id}', '${staff.name.replace(/'/g, "\\'")}', ${staff.paidMonths})">
                  <i class="fas fa-edit"></i>
                </div>
                <div class="action-icon delete-icon" onclick="openDeleteStaffModal('${staff.id}', '${staff.name.replace(/'/g, "\\'")}')">
                  <i class="fas fa-trash"></i>
                </div>
              </td>
            </tr>
          `;
        });
      }
      
      content += `
            </tbody>
          </table>
        </div>
      `;
      
      contentDiv.innerHTML = content;
    }
    
    // Sort table function
    function sortTable(column) {
      if (currentSort.column === column) {
        // Toggle direction if same column clicked
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
      } else {
        // New column, default to ascending
        currentSort.column = column;
        currentSort.direction = 'asc';
      }
      showDashboard();
    }
    
    // Set filter function
    function setFilter(filter) {
      currentFilter = filter;
      showDashboard();
    }
    
    // Filter staff by search term
    function filterStaff() {
      currentSearch = document.getElementById('searchInput').value;
      showDashboard();
    }
    
    // Add Staff functions
    function openAddStaffModal() {
      document.getElementById('staffName').value = '';
      document.getElementById('paidMonths').value = '0';
      document.getElementById('nameError').style.display = 'none';
      document.getElementById('monthsError').style.display = 'none';
      document.getElementById('addStaffModal').style.display = 'flex';
    }
    
    function closeAddStaffModal() {
      document.getElementById('addStaffModal').style.display = 'none';
    }
    
    function addNewStaff() {
      const name = document.getElementById('staffName').value.trim();
      const paidMonths = parseInt(document.getElementById('paidMonths').value);
      
      // Validate inputs
      let valid = true;
      
      if (name.length < 3) {
        document.getElementById('nameError').style.display = 'block';
        valid = false;
      } else {
        document.getElementById('nameError').style.display = 'none';
      }
      
      if (isNaN(paidMonths) || paidMonths < 0) {
        document.getElementById('monthsError').style.display = 'block';
        valid = false;
      } else {
        document.getElementById('monthsError').style.display = 'none';
      }
      
      if (!valid) return;
      
      const totalAmount = paidMonths * 20;
      const lastUpdated = new Date().toLocaleDateString('en-US', { 
        month: 'long', 
        year: 'numeric' 
      });
      
      db.collection("staff").add({
        name,
        paidMonths,
        totalAmount,
        lastUpdated
      })
      .then(() => {
        showToast("New staff added successfully!", "success");
        closeAddStaffModal();
      })
      .catch(error => {
        console.error("Error adding staff:", error);
        showToast("Error adding staff: " + error.message, "error");
      });
    }
    
    // Edit Staff functions
    function openEditStaffModal(id, name, paidMonths) {
      currentStaffId = id;
      document.getElementById('editStaffName').value = name;
      document.getElementById('editPaidMonths').value = paidMonths;
      document.getElementById('editNameError').style.display = 'none';
      document.getElementById('editMonthsError').style.display = 'none';
      document.getElementById('editStaffModal').style.display = 'flex';
    }
    
    function closeEditStaffModal() {
      document.getElementById('editStaffModal').style.display = 'none';
    }
    
    function updateStaffDetails() {
      const name = document.getElementById('editStaffName').value.trim();
      const paidMonths = parseInt(document.getElementById('editPaidMonths').value);
      
      // Validate inputs
      let valid = true;
      
      if (name.length < 3) {
        document.getElementById('editNameError').style.display = 'block';
        valid = false;
      } else {
        document.getElementById('editNameError').style.display = 'none';
      }
      
      if (isNaN(paidMonths) || paidMonths < 0) {
        document.getElementById('editMonthsError').style.display = 'block';
        valid = false;
      } else {
        document.getElementById('editMonthsError').style.display = 'none';
      }
      
      if (!valid) return;
      
      const totalAmount = paidMonths * 20;
      const lastUpdated = new Date().toLocaleDateString('en-US', { 
        month: 'long', 
        year: 'numeric' 
      });
      
      db.collection("staff").doc(currentStaffId).update({
        name,
        paidMonths,
        totalAmount,
        lastUpdated
      })
      .then(() => {
        showToast("Staff details updated successfully!", "success");
        closeEditStaffModal();
      })
      .catch(error => {
        console.error("Error updating staff details:", error);
        showToast("Error updating staff details: " + error.message, "error");
      });
    }
    
    // Delete Staff functions
    function openDeleteStaffModal(id, name) {
      currentStaffId = id;
      document.getElementById('deleteStaffName').textContent = name;
      document.getElementById('deleteStaffModal').style.display = 'flex';
    }
    
    function closeDeleteStaffModal() {
      document.getElementById('deleteStaffModal').style.display = 'none';
    }
    
    function confirmDeleteStaff() {
      db.collection("staff").doc(currentStaffId).delete()
        .then(() => {
          showToast("Staff member deleted successfully!", "success");
          closeDeleteStaffModal();
        })
        .catch(error => {
          console.error("Error deleting staff:", error);
          showToast("Error deleting staff: " + error.message, "error");
        });
    }
    
    // PDF Generation
    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      // Title
      doc.setFontSize(20);
      doc.text("Fian Health Staff Welfare Report", 105, 15, { align: 'center' });
      
      // Date
      doc.setFontSize(12);
      doc.text(`Generated: ${new Date().toLocaleDateString()}`, 105, 25, { align: 'center' });
      
      // Statistics
      const totalStaff = staffData.length;
      const totalContributions = staffData.reduce((sum, staff) => sum + staff.totalAmount, 0);
      const paidStaff = staffData.filter(staff => staff.paidMonths > 0).length;
      
      doc.setFontSize(14);
      doc.text(`Total Staff: ${totalStaff}`, 20, 35);
      doc.text(`Total Contributions: GH₵ ${totalContributions}`, 20, 42);
      doc.text(`Staff Paid: ${paidStaff}`, 20, 49);
      
      // Table headers
      const headers = [['Name', 'Paid Months', 'Total Amount (GH₵)', 'Status']];
      
      // Table data
      const data = staffData.map(staff => [
        staff.name,
        staff.paidMonths,
        staff.totalAmount,
        staff.paidMonths > 0 ? 'Paid' : 'Not Paid'
      ]);
      
      // Generate table
      doc.autoTable({
        startY: 55,
        head: headers,
        body: data,
        theme: 'grid',
        styles: { fontSize: 10 },
        headStyles: { fillColor: [44, 62, 80] }
      });
      
      // Save the PDF
      doc.save(`fian-health-staff-report-${new Date().toISOString().slice(0, 10)}.pdf`);
      
      showToast("PDF report downloaded successfully!", "success");
    }
    
    // Export to CSV
    function exportToCSV() {
      let csvContent = "data:text/csv;charset=utf-8,";
      
      // CSV headers
      csvContent += "Name,Paid Months,Total Amount (GH₵),Status,Last Updated\n";
      
      // Add rows
      staffData.forEach(staff => {
        const status = staff.paidMonths > 0 ? 'Paid' : 'Not Paid';
        const row = `"${staff.name}",${staff.paidMonths},${staff.totalAmount},"${status}","${staff.lastUpdated}"`;
        csvContent += row + "\n";
      });
      
      // Create download link
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", `fian-health-staff-data-${new Date().toISOString().slice(0, 10)}.csv`);
      document.body.appendChild(link);
      
      // Trigger download
      link.click();
      document.body.removeChild(link);
      
      showToast("CSV file downloaded successfully!", "success");
    }
    
    // Payment history placeholder
    function showPaymentHistory() {
      contentDiv.innerHTML = `
        <div class="dashboard-header">
          <h2>Payment History</h2>
          <div class="action-buttons">
            <button class="action-btn download-btn" onclick="showDashboard()">
              <i class="fas fa-arrow-left"></i> Back to Dashboard
            </button>
          </div>
        </div>
        
        <div style="text-align: center; padding: 50px;">
          <i class="fas fa-history" style="font-size: 3rem; color: #3498db; margin-bottom: 20px;"></i>
          <h3>Payment History Tracking</h3>
          <p>This feature is under development and will be available in the next update.</p>
          <p>It will provide a detailed history of all contributions made by each staff member.</p>
        </div>
      `;
    }
    
    // Utility functions
    function showToast(message, type) {
      const toast = document.getElementById('toast');
      const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
      toast.innerHTML = `<i class="fas ${icon}"></i> <span>${message}</span>`;
      toast.className = `toast ${type} show`;
      
      setTimeout(() => {
        toast.className = 'toast';
      }, 3000);
    }
    
    // Initialize the app
    window.onload = function() {
      // Pre-fill email for convenience
      loginEmail.value = "admin@fianhealth.com";
      
      // Create admin account if it doesn't exist
      createAdminAccount();
    };
  </script>
</body>
</html>